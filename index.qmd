---
title: "Suicidios en Chile según género"
subtitle: "(2017–2024)"
author: "Bastián Olea Herrera"
format: 
  html:
    theme: estilos.scss
    toc: true
    toc-title: Índice
    toc-location: right
    anchor-sections: false 
    grid:
      body-width: 600px
fontfamily: Cabin
lang: es
execute: 
  echo: false
  message: false
  warning: false
  cache: false
knitr:
  opts_chunk:
    dev: "ragg_png"
    dev.args:
      bg: "transparent"
editor_options: 
  chunk_output_type: console
---

```{r paquetes}
#| cache: false
library(dplyr)
library(ggplot2)
library(ggforce)
library(ggblend)
library(scales)
library(tidyr)
library(stringr)

source("funciones.R")

```

```{r colores}
#| output: false
color_base <- "#CA1F7B"

color <- list(femenino = color_base,
              masculino = color_base |> col_darker(5) |> col_saturate(-30) |> col_shift(-30),
              # fondo = color_base |> col_darker(38) |> col_saturate(-45),
              fondo = color_base |> col_darker(39) |> col_saturate(-50),
              texto = color_base |> col_lighter(35) |> col_saturate(-50),
              destacado = color_base |> col_lighter(20) |> col_saturate(-30),
              titulos = color_base |> col_darker(10) |> col_saturate(-40),
              # titulos = color_base |> col_lighter(25) |> col_saturate(-40),
              detalle = color_base |> col_darker(20) |> col_saturate(-40),
              tenue = color_base |> col_darker(30) |> col_saturate(-45))

color

# previsualizar paleta
# show_col(unlist(color))

```

```{r setup}
# tema
theme_set(
  theme_minimal(ink = color$texto,
                paper = color$fondo,
                base_family = "Rubik") +
    theme(legend.position = "none") +
    theme(panel.grid = element_line(linetype = "dashed", color = color$tenue),
          panel.grid.minor = element_blank())
)

# tipografía desde google fonts
library(showtext)
font_add_google("Cabin", "Cabin")
font_add_google("Rubik", "Rubik")
showtext_auto()
showtext_opts(dpi = 240)

library(gfonts)
use_font("cabin", "fonts/css/cabin.css")

# opciones de formato de números
number_options(big.mark = ".",
               decimal.mark = ",")
```

```{r datos}
#| cache: true

# cargar datos
datos <- arrow::read_parquet("datos/minsal_suicidios.parquet")

# años 
años <- datos |> 
  summarize(min = min(año),
            max = max(año)) |> 
  mutate(texto = paste0(min, "–", max),
         frase = paste(min, "y", max))

# general
conteo <- datos |> 
  summarize(valor = sum(valor), 
            .by = c(genero, condicion)) |> 
  mutate(porcentaje = valor / sum(valor),
         .by = genero) |> 
  mutate(maximo = max(valor),
         .by = genero)

# conteo
datos_conteo <- conteo |> 
  mutate(horizontal = case_when(
    condicion == "intento" & genero == "femenino" ~ 1-max(valor)-200,
    condicion == "intento" & genero == "masculino" ~ 1+maximo+200,
    condicion == "consumado" & genero == "femenino" ~ 1-200,
    condicion == "consumado" & genero == "masculino" ~ 1+valor+50)) |>
  mutate(condicion = forcats::fct_relevel(condicion, "consumado", "intento", )) |>
  mutate(vertical = case_match(
    genero,
    "femenino" ~ 1,
    "masculino" ~ 1)) 

# evolución
datos_año <- datos |> 
  group_by(año, genero, condicion) |> 
  summarize(valor = sum(valor), .groups = "drop") |> 
  mutate(condicion = recode_values(condicion,
                                   "intento" ~ "Intentos de suicidio",
                                   "consumado" ~ "Suicidios consumados"))

# diagnósticos de causas
datos_diag <- arrow::read_parquet("datos/minsal_suicidios_diagnostico.parquet")

datos_diag <- datos_diag |> 
  limpiar_causas()

datos_diag_conteo <- datos_diag |> 
  filter(condicion_egreso == "consumado") |>
  select(genero, glosa) |>
  count(genero, glosa, sort = T) |>
  complete(genero, glosa, fill = list(n = 0)) |>
  # print(n=Inf)
  group_by(genero) |> 
  mutate(p = n / sum(n)) |> 
  group_by(glosa) |> 
  mutate(total = sum(n)) |> 
  ungroup() |> 
  filter(total > 3) |> 
  mutate(glosa = forcats::fct_reorder(glosa, total))

datos_diag_wide <- datos_diag_conteo |>
  select(-total, -p) |> 
  pivot_wider(names_from = genero, values_from = n, 
              values_fill = 0) |> 
  mutate(mayor = if_else(femenino >= masculino, "femenino", "masculino")) |> 
  mutate(menor = if_else(femenino < masculino, "femenino", "masculino")) |> 
  group_by(glosa) |> 
  mutate(max = max(femenino, masculino),
         min = min(femenino, masculino))
```

El [Departamento de Estadísticas e Información de Salud](https://deis.minsal.cl) (DEIS) del Ministerio de Salud de Chile, a través de su [plataforma de datos abiertos](https://deis.minsal.cl/#datosabiertos), proporciona datos detallados sobre **egresos médicos**, que corresponden a casos de pacientes hospitalizados y sus desenlaces. 

Los datos de egresos médicos incluyen el diagnóstico de las y los pacientes, su género, su ubicación, y si sobrevivieron o no a sus aflicciones. Según el diagnóstico de cada paciente, es posible identificar casos de **lesiones autoinfligidas intencionalmente**, interpretables como **intentos de suicidio**. En base al egreso _con vida_ (alta médica) o _sin vida_ (fallecimiento) de los pacientes, se pueden distinguir **intentos de suicidio** y **suicidios consumados**.

En esta plataforma se exploran estas estadísticas de suicidio en Chile, entre `r años$frase`, y **con perspectiva de género**, visibilizando las diferencias que sufren [mujeres]{.fem} y [hombres]{.masc}.


::: {.ayuda}

Si estás pasando por un momento difícil, por favor busca ayuda.

- _Línea de prevención del suicidio (Chile):_ llama al *4141 a cualquier hora del día.
- _Fono de orientación en violencias de género:_ llama al 1455

:::


## Tendencia en los intentos de suicidio

En los últimos 6 años, y según los datos de egresos médicos, las estadísticas de **intentos de suicidio** en Chile han ido **en aumento**.

```{r}
aumento_intentos <- datos_año |> 
  filter(condicion == "Intentos de suicidio") |> 
  filter(año == min(año) | año == max(año)) |> 
  pivot_wider(names_from = año, values_from = valor,
              names_prefix = "valor_") |> 
  mutate(p = (valor_2024 - valor_2017) / valor_2017) |> 
  select(genero, p) |> 
  pivot_wider(names_from = genero, values_from = p)

aumento_intentos_fem_n <- datos_año |> 
  filter(genero == "femenino", condicion == "Intentos de suicidio") |> 
  filter(año %in% c(2017, 2024)) |> 
  select(año, valor) |> 
  pivot_wider(names_from = año, values_from = valor,
              names_prefix = "valor_")
```

Entre los años `r años$frase`, los intentos de suicidio en [mujeres]{.fem} han aumentado en un `r percent(aumento_intentos$femenino)`, pasando de 
`r number(aumento_intentos_fem_n$valor_2017)` intentos en `r años$min` a `r number(aumento_intentos_fem_n$valor_2024)` intentos en `r años$max`, mientras que en [hombres]{.masc} el aumento ha sido de `r percent(aumento_intentos$masculino)`.


```{r suicidio_intentos_años}
datos_año |> 
  filter(condicion == "Intentos de suicidio") |>
  grafico_lineas()
```

```{r}
aumento_intentos_2022 <- datos_año |> 
  filter(condicion == "Intentos de suicidio") |> 
  filter(año == 2021 | año == 2022) |> 
  pivot_wider(names_from = año, values_from = valor,
              names_prefix = "valor_") |> 
  mutate(p = (valor_2022 - valor_2021) / valor_2021) |> 
  select(genero, p) |> 
  pivot_wider(names_from = genero, values_from = p)
```

Entre los años 2021 y 2022, durante la **pandemia**, destaca un **aumento** en los intentos de suicidio en [mujeres]{.fem} de un `r percent(aumento_intentos_2022$femenino)`.

```{r}
comparacion_intento_fem <- conteo |> 
  filter(condicion == "intento") |> 
  select(genero, valor) |>
  pivot_wider(names_from = genero, values_from = valor) |> 
  mutate(veces = femenino / masculino)
```

Si consideramos la **cantidad total de casos** entre `r años$frase`, vemos que las [mujeres]{.fem} presentan una **cantidad mucho mayor** de intentos de suicidio que los hombres: `r number(comparacion_intento_fem$femenino)` casos, que equivalen a una cantidad `r number(comparacion_intento_fem$veces, accuracy = 0.1)` veces mayor que los casos en [hombres]{.masc} (`r number(comparacion_intento_fem$masculino)`).

```{r suicidio_intentos_comparacion}
conteo |> 
  filter(condicion == "intento") |>
  grafico_circulos_encima()
```

El gráfico anterior simboliza la diferencia entre ambas cifras mediante el diámetro de los círculos.

## Mayor cantidad de víctimas fatales en hombres

Sin embargo, cuando analizamos las cifras de víctimas de **suicidios consumados**; es decir, intentos de suicidio con consecuencias letales entre `r años$frase`, se presenta una mayoría de casos de [hombres]{.masc}.


```{r suicidio_consumados_comparacion}
conteo |> 
  filter(condicion == "consumado") |>
  grafico_circulos_encima()
```

```{r}
comparacion_consumado_masc <- conteo |> 
  filter(condicion == "consumado") |> 
  select(genero, valor) |>
  pivot_wider(names_from = genero, values_from = valor) |> 
  mutate(dif = masculino - femenino)
```


Se evidencia un total de `r number(comparacion_consumado_masc$masculino)` víctimas fatales
en [hombres]{.masc}, que significa una
diferencia de `r number(comparacion_consumado_masc$dif)` muertes por sobre la cantidad de víctimas mujeres (`r number(comparacion_consumado_masc$femenino)`).


## Tendencia en suicidios consumados

```{r}
aumento_consumados <- datos_año |> 
  filter(condicion == "Suicidios consumados") |> 
  filter(año == min(año) | año == max(año)) |> 
  pivot_wider(names_from = año, values_from = valor,
              names_prefix = "valor_") |> 
  mutate(p = (valor_2024 - valor_2017) / valor_2017) |> 
  select(genero, p) |> 
  pivot_wider(names_from = genero, values_from = p)
```

La **tendencia** de los suicidios consumados es distinta a los intentos de suicidio. Comparando `r años$frase`, los suicidios consumados han disminuido un `r percent(aumento_consumados$masculino)` en [hombres,]{.masc} mientras que en mujeres han aumentado un `r percent(aumento_consumados$femenino)`. 

```{r suicidio_consumados_años}

datos_año |> 
  filter(condicion == "Suicidios consumados") |>
  # grafico_lineas() +
  ggplot() +
  aes(x = año, y = valor, color = genero) +
  scale_x_continuous(breaks = seq(min(datos$año), max(datos$año), 1),
                     expand = expansion(c(0.02, 0.1))) +
  scale_y_continuous(labels = number,
                     limits = c(0, NA),
                     expand = expansion(c(0, -0.2))) +
  # fondo indicando periodo de pandemia
  annotate(geom = "rect",
           xmin = 2020.2, xmax = 2021.8, ymin = -Inf, ymax = Inf,
           fill = color$detalle, alpha = 0.3,
           alpha = 0.1) +
  annotate(geom = "text", x = 2021, y = I(.95), label = "Pandemia",
           color = color$titulos, size = 3.5, alpha = 1) +
  scale_y_continuous(labels = number,
                     breaks = pretty_breaks(n = 8),
                     expand = expansion(c(0.07, 0.07))) +
  # líneas
  geom_line(linewidth = 1.5, lineend = "round") +
  stat_smooth(geom = "line", 
              alpha = 0.6, linetype = "dashed", linewidth = 1, lineend = "round") +
  # puntos
  geom_point(data = ~filter(.x, año == max(año)), size = 6, color = color$fondo) +
  geom_point(data = ~filter(.x, año == max(año)), size = 4) +
  # texto final
  geom_text(data = ~filter(.x, año == max(año)),
            aes(label = number(valor)),
            nudge_x = 0.13,
            size = 4, fontface = "bold", hjust = 0) |> 
  ggblend::copy_over(color = color$texto, alpha = 0.4) +
  # texto 2022
  geom_text(data = ~filter(.x, año %in% 2022),
            aes(label = number(valor)),
            nudge_y = 1.6, 
            size = 4, fontface = "bold") |> 
  ggblend::copy_over(color = color$texto, alpha = 0.4) +
  # temas
  theme(legend.position = "none") +
  escala_genero() +
  coord_cartesian(clip = "off") +
  labs(y = "Casos", x = NULL) +
  theme(axis.text.x = element_text(face = "bold", color = color$texto, size = 11, vjust = 0),
        axis.title.y = element_text(vjust = 1, margin = margin(r = 4))) +
  theme(axis.line = element_line(color = color$detalle, lineend = "round", linewidth = 1))
```


Como se aprecia en el gráfico anterior, estas tendencias se ven influenciadas por la **pandemia del Covid-19**, que alteró los comportamientos sociales y tuvo un efecto en la salud mental de las personas.

```{r}
aumento_consumados_2022 <- datos_año |> 
  filter(condicion == "Suicidios consumados") |> 
  filter(año == 2021 | año == 2022) |> 
  pivot_wider(names_from = año, values_from = valor,
              names_prefix = "valor_") |> 
  mutate(p = (valor_2022 - valor_2021) / valor_2021) |> 
  select(genero, p) |> 
  pivot_wider(names_from = genero, values_from = p)
```

Durante la **pandemia**, entre 2021 y 2022 ambos géneros presentaron fuertes aumentos en la cantidad de víctimas, de `r percent(aumento_consumados_2022$masculino)` y `r percent(aumento_consumados_2022$femenino)` en hombres y mujeres respectivamente.


```{r}
disminucion_consumados_2024 <- datos_año |> 
  filter(condicion == "Suicidios consumados") |> 
  filter(año == 2022 | año == 2024) |> 
  pivot_wider(names_from = año, values_from = valor,
              names_prefix = "valor_") |> 
  mutate(p = (valor_2024 - valor_2022) / valor_2024) |> 
  select(genero, p) |> 
  pivot_wider(names_from = genero, values_from = p)
```

Pero después de 2022, posterior al periodo de pandemia, se observa una tendencia a la **disminución de los suicidios** en ambos géneros: el suicidio entre 2022 y 2024 se reduce en un `r percent(disminucion_consumados_2024$masculino)` entre los [hombres]{.masc} y en un `r percent(disminucion_consumados_2024$femenino)` entre [mujeres.]{.fem}.




## Diferencias en perspectiva

Como podemos ver, el fenómeno presenta disparidades entre géneros complejas: las [mujeres]{.fem} recurren al intento de suicidio en mucha mayor cantidad que los hombres, pero los [hombres]{.masc} concretan el suicidio en mayor cantidad.

Esta gráfica enfrenta las realidades de [mujeres]{.fem} (a la izquierda) y [hombres]{.masc} (a la derecha), midiendo la cantidad de víctimas en círculos, donde los círculos centrales representan las víctimas fatales.

```{r suidicio_unidos}
distancia <- 280

datos_conteo <- conteo |> 
  mutate(horizontal = case_when(
    condicion == "intento" & genero == "femenino" ~ 1-max(valor)-distancia,
    condicion == "intento" & genero == "masculino" ~ 1+maximo+distancia,
    condicion == "consumado" & genero == "femenino" ~ 1-distancia,
    condicion == "consumado" & genero == "masculino" ~ 1+valor+10)) |>
  mutate(condicion = forcats::fct_relevel(condicion, "consumado", "intento", )) |>
  mutate(vertical = case_match(
    genero,
    "femenino" ~ 1,
    "masculino" ~ 1)) 

datos_conteo |> 
  grafico_circulos_unidos()
```

```{r suidicio_unidos_cifras}
diferencia_consumados <- datos_conteo |> 
  filter(condicion == "consumado") |> 
  select(genero, valor) |> 
  pivot_wider(names_from = genero, values_from = valor) |> 
  mutate(diferencia = masculino - femenino) |> 
  pull(diferencia)

diferencia_intentos <- datos_conteo |> 
  filter(condicion == "intento") |> 
  select(genero, valor) |> 
  pivot_wider(names_from = genero, values_from = valor) |> 
  mutate(diferencia = femenino - masculino) |> 
  pull(diferencia)

posicion_intentos <- datos_conteo |> 
  filter(genero == "femenino",
         condicion == "intento") |> 
  pull(horizontal)
```


:::: {.columns}

::: {.column}

Por un lado, las [mujeres]{.fem} presentan una mayor cantidad de intentos de suicidio entre `r años$frase`, con `r number(diferencia_intentos)` intentos más que los hombres.

:::

::: {.column style='text-align: right;'}

Por otro lado, los [hombres]{.masc} presentan una mayor cantidad de suicidios consumados entre `r años$frase`, con `r number(diferencia_consumados)` suicidios más que las mujeres.

:::

::::



## Métodos según género

Las diferencias de género prevalecen también en los métodos de las **lesiones autoinflingidas intencionalmente**. Este gráfico muestra la cantidad de casos según el tipo de lesiones diagnosticado.

Los suicidios por ahorcamiento, armas de fuego, y objetos cortantes son más prevalentes en [hombres,]{.masc} mientras que el uso de drogas o medicamentos de distintos tipos son más frecuentes en [mujeres.]{.fem}

```{r suicidio_causas_consumado}
#| fig-height: 6.5
datos_diag_conteo |> 
  grafico_causas(datos_diag_wide) +
  escala_genero()
```

El tipo de lesión intencional más frecuente entre ambos géneros es el _ahorcamiento, estrangulamiento o sofocación_ en [hombres.]{.masc}

::: {.espaciado}

El fenómeno del suicidio es oscuro y complejo. Estas diferencias estadísticas expresan una realidad trágica, sufrida de maneras diferentes por hombres y mujeres.

Estas visualizaciones son sólo un intento por compartir datos sobre este fenómeno, con el fin de propiciar la reflexión sobre salud mental con perspectiva de género.

:::

::: {.ayuda}

Si estás pasando por un momento difícil, o estás teniendo ideas suicidas, **por favor busca ayuda**. El suicidio nunca es la solución, y te aseguro que todo va a mejorar.

- _Línea de prevención del suicidio (Chile):_ llama al *4141 a cualquier hora del día.
- _Fono de orientación en violencias de género:_ llama al 1455

:::

::: {.footer}

Desarrollado por [Bastián Olea Herrera](https://bastianolea.rbind.io) con el lenguaje de programación R. Código disponible en [GitHub](https://github.com/bastianolea/minsal_suicidios_genero).

::::